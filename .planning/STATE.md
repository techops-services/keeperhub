# Project State

## Project Reference

See: .planning/PROJECT.md (updated 2026-02-20)

**Core value:** Users can build and deploy Web3 automation workflows through a visual builder without writing code
**Current focus:** v1.2 Protocol Registry - Phase 9: Hub UI

## Current Position

Phase: 9 of 9 (Hub UI)
Plan: 09-01 complete, executing 09-02
Status: Executing
Last activity: 2026-02-20 -- Plan 09-01 complete (protocol API, tab switcher, protocol grid)

Progress: [█████████░] ~88% (v1.2)

## Performance Metrics

**Velocity:**
- Total plans completed: 21 (v1.0: 12, v1.1: 2, v1.2: 7)
- Average duration: 4 min
- v1.0 total: ~40 min
- v1.1 total: ~10 min
- v1.2 so far: ~29 min (8 plans)

## Accumulated Context

### Decisions

- outputFileTracingIncludes for @vercel/og: forces dynamically-imported WASM into standalone
- Phase 6 dropped from v1.1: meta tags/social validation deferred
- File-based protocol definitions (no DB for MVP)
- Reuse existing read/write-contract core via -core.ts extraction
- Generic protocol icon for MVP -- custom icons per-protocol deferred to future
- Core logic files (read-contract-core.ts, write-contract-core.ts) have no "use step" -- only way to share step logic across multiple step files without breaking workflow bundler
- _context type inlined in core input types (no StepInput import) -- step-handler is step-only infrastructure
- defineProtocol() is an identity function (returns def unchanged) -- TypeScript enforces shape at compile time, runtime validates correctness
- Module-level KEBAB_CASE_REGEX and HEX_ADDRESS_REGEX constants used to satisfy Biome useTopLevelRegex rule
- protocolToPlugin imports ProtocolIcon directly (no icon parameter) -- single canonical icon for all protocol plugins at MVP
- Plugin shell index.ts does not call registerIntegration() -- registration handled by discover-plugins (Plan 03)
- _protocolMeta field uses type=text with JSON defaultValue -- UI hides underscore-prefixed fields automatically
- buildFunctionArgs extracted as non-exported module-level function per step file -- cannot be shared due to "use step" bundler constraints; intentional duplication
- protocol-write passes _context.triggerType to writeContractCore for gas strategy (manual vs automated trigger pricing)
- registeredProtocolSlugs module-level variable in discover-plugins for cross-function communication (populated by registerProtocolPlugins, consumed by generateStepRegistry and processStepFilesForCodegen)
- generateTypesFile() called once after registerProtocolPlugins() in main() -- ordering required for correct IntegrationType union generation
- Protocol steps skipped in processStepFilesForCodegen() -- no stepHandler function, delegate to shared core files
- keeperhub/protocols/index.ts barrel generated by discover-plugins -- imports all protocol definitions and registers them at import time
- Protocol plugin shell imports @/keeperhub/protocols as side-effect -- triggers registration at server startup via plugin import chain
- slugToVarName() converts protocol slugs to valid JS variable names (e.g., "aave-v3" → "aaveV3Def")
- registeredProtocolEntries module-level variable stores protocol metadata for barrel generation
- fetchAbiFromExplorer extracted as non-exported module-level function to keep resolveAbi cognitive complexity under 15
- ABI cache key format: chainId:lowercaseAddress for deterministic lookups
- resolveAbi uses shared lib/explorer modules directly, does not call fetch-abi API route
- Protocol address keys use numeric chain ID strings (e.g., "1", "8453") matching chain-select stored values
- Omitted Polygon from WETH -- that address is WMATIC, semantically different
- chain-utils.ts is client-safe (no server imports) -- maps numeric chain ID strings to human-readable names
- Protocol API endpoint is synchronous (no async) -- registry is populated at import time via side-effect import
- _selectedProtocol underscore prefix for unused destructured state -- Plan 02 will consume it
- Tab switcher uses underline variant via className overrides on shadcn Tabs components
- Protocol search is a standalone inline input (not reusing WorkflowSearchFilter) to avoid over-complicating the existing component

### Pending Todos

- [ ] Merge PR #195 (monorepo cleanup) after stability verification
- [ ] Run git-filter-repo after PR merge
- [ ] Fix workflow OG node icons and names not rendering (PR #326 open)
- [ ] Meta tags & social platform validation (deferred from v1.1 Phase 6)

### Blockers/Concerns

None

## Session Continuity

Last session: 2026-02-20
Stopped at: Plan 09-01 complete, executing Plan 09-02
Resume file: None

**Next action:** Complete Plan 09-02 (protocol detail view)
