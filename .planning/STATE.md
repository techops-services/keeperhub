# Project State

## Project Reference

See: .planning/PROJECT.md (updated 2026-02-20)

**Core value:** Users can build and deploy Web3 automation workflows through a visual builder without writing code
**Current focus:** v1.2 Protocol Registry - Phase 7: Plugin Auto-Generation

## Current Position

Phase: 7 of 9 (Plugin Auto-Generation)
Plan: 4 of 4 in current phase
Status: In progress
Last activity: 2026-02-20 -- completed 07-04 (runtime protocol bootstrap via import chain)

Progress: [████░░░░░░] ~20% (v1.2)

## Performance Metrics

**Velocity:**
- Total plans completed: 19 (v1.0: 12, v1.1: 2, v1.2: 5)
- Average duration: 4 min
- v1.0 total: ~40 min
- v1.1 total: ~10 min
- v1.2 so far: ~22 min (6 plans)

## Accumulated Context

### Decisions

- outputFileTracingIncludes for @vercel/og: forces dynamically-imported WASM into standalone
- Phase 6 dropped from v1.1: meta tags/social validation deferred
- File-based protocol definitions (no DB for MVP)
- Reuse existing read/write-contract core via -core.ts extraction
- Generic protocol icon for MVP -- custom icons per-protocol deferred to future
- Core logic files (read-contract-core.ts, write-contract-core.ts) have no "use step" -- only way to share step logic across multiple step files without breaking workflow bundler
- _context type inlined in core input types (no StepInput import) -- step-handler is step-only infrastructure
- defineProtocol() is an identity function (returns def unchanged) -- TypeScript enforces shape at compile time, runtime validates correctness
- Module-level KEBAB_CASE_REGEX and HEX_ADDRESS_REGEX constants used to satisfy Biome useTopLevelRegex rule
- protocolToPlugin imports ProtocolIcon directly (no icon parameter) -- single canonical icon for all protocol plugins at MVP
- Plugin shell index.ts does not call registerIntegration() -- registration handled by discover-plugins (Plan 03)
- _protocolMeta field uses type=text with JSON defaultValue -- UI hides underscore-prefixed fields automatically
- buildFunctionArgs extracted as non-exported module-level function per step file -- cannot be shared due to "use step" bundler constraints; intentional duplication
- protocol-write passes _context.triggerType to writeContractCore for gas strategy (manual vs automated trigger pricing)
- registeredProtocolSlugs module-level variable in discover-plugins for cross-function communication (populated by registerProtocolPlugins, consumed by generateStepRegistry and processStepFilesForCodegen)
- generateTypesFile() called once after registerProtocolPlugins() in main() -- ordering required for correct IntegrationType union generation
- Protocol steps skipped in processStepFilesForCodegen() -- no stepHandler function, delegate to shared core files
- keeperhub/protocols/index.ts barrel generated by discover-plugins -- imports all protocol definitions and registers them at import time
- Protocol plugin shell imports @/keeperhub/protocols as side-effect -- triggers registration at server startup via plugin import chain
- slugToVarName() converts protocol slugs to valid JS variable names (e.g., "aave-v3" → "aaveV3Def")
- registeredProtocolEntries module-level variable stores protocol metadata for barrel generation

### Pending Todos

- [ ] Merge PR #195 (monorepo cleanup) after stability verification
- [ ] Run git-filter-repo after PR merge
- [ ] Fix workflow OG node icons and names not rendering (PR #326 open)
- [ ] Meta tags & social platform validation (deferred from v1.1 Phase 6)

### Blockers/Concerns

None

## Session Continuity

Last session: 2026-02-20
Stopped at: Completed 07-04-PLAN.md -- runtime protocol bootstrap via import chain
Resume file: None

**Next action:** Phase 7 complete -- move to Phase 8 or create verification plan
